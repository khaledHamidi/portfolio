{{/* CustomCollection.html — Grid of 3 horizontal cards */}}

{{ $page         := .wcPage }}
{{ $block        := .wcBlock }}
{{ $items_offset := $block.content.offset | default 0 }}
{{ $items_count  := 3 }}

{{/* Build the query */}}
{{ $query := site.RegularPages }}
{{ with $block.content.filters.folders }}
  {{ $query = where $query "Section" "in" . }}
{{ end }}
{{ $query = first $items_count (after $items_offset $query) }}

{{ with $block.content.title }}
  <div class="text-center mb-8">
    <h2 class="text-3xl font-bold text-gray-900 dark:text-white">
      {{ . | emojify | $page.RenderString }}
    </h2>
  </div>
{{ end }}

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 px-4">

  {{ range $item := $query }}
    {{ $img := partial "functions/get_featured_image.html" $item }}

    <a href="{{ $item.RelPermalink }}"
       class="block bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-hidden
              hover:shadow-xl transition-all duration-300">

      {{ with $img }}
        <!-- ✅ FIX: use .RelPermalink if $img is a resource, otherwise use the string itself -->
        <img src="{{ default . .RelPermalink }}"
             alt="{{ $item.Title }}"
             class="w-full h-48 object-cover object-center">
      {{ end }}

      <div class="p-5">
        <h3 class="text-xl font-semibold text-gray-800 dark:text-white">
          {{ $item.Title }}
        </h3>
      </div>

    </a>
  {{ end }}

</div>
